<!-- Header -->
<header class="header" role="banner">
  <div class="container">
    <div class="header-content">
      <div class="logo">
        <span class="logo-icon">üìö</span>
        <span class="logo-text">EnglishMaster</span>
        <!-- Accessibility Content -->
                </div>

                 <!-- Dark/Light Mode -->
          <div class="config-card">
            <div class="card-header">
              <div class="card-icon">üåô</div>
              <h2 class="card-title">Dark Mode</h2>
            </div>
            <div class="card-content">
              <div class="accessibility-option">
                <div class="option-icon">
                  <span class="theme-icon">üåô</span>
                </div>
                <div class="option-content">
                  <p>Switch between light and dark theme to reduce eye strain.</p> 
          (click)="navigateToProfile()"
          type="button"
          aria-label="Go to user profile">
          <span aria-hidden="true">üë§</span> Profile
        </button>
        <button 
          class="btn btn-primary" 
          (click)="logout()"
          type="button"
          aria-label="Log out and exit the application">
          Exit
        </button>
      </div>
    </div>
  </div>
</header>

<!-- Success Message -->
<div class="success-message" [class.show]="showSaveMessage">
  <div class="success-content">
    <span class="success-icon">‚úÖ</span>
    <span class="success-text">{{ saveMessage }}</span>
  </div>
</div>

<main class="main">
  <div class="container">
    <div class="config-layout">
      <!-- Side Panel -->
      <aside class="sidebar">
        <div class="profile-section">
          <div class="profile-avatar">
            <span class="avatar-icon">üë§</span>
          </div>
          <button 
            class="sidebar-btn" 
            [class.active]="isActiveSection('perfil')"
            (click)="setActiveSection('perfil')">
            Edit Profile
          </button>
          <button 
            class="sidebar-btn" 
            [class.active]="isActiveSection('accesibilidad')"
            (click)="setActiveSection('accesibilidad')">
            Accessibility
          </button>
          <button 
            class="sidebar-btn" 
            [class.active]="isActiveSection('notificaciones')"
            (click)="setActiveSection('notificaciones')">
            Notifications
          </button>
          <button 
            class="sidebar-btn" 
            [class.active]="isActiveSection('preferencias')"
            (click)="setActiveSection('preferencias')">
            Preferences
          </button>
        </div>
      </aside>

      <!-- Main Content -->
      <section class="main-content">
        <h1 class="page-title">
          <span class="title-icon">‚öôÔ∏è</span>
          User Settings
        </h1>
        
        <!-- Profile Content -->
        <div *ngIf="activeSection === 'perfil'">
          <form [formGroup]="profileForm" (ngSubmit)="onProfileSubmit()">
            <!-- Basic Information -->
            <div class="config-card">
              <div class="card-header">
                <div class="card-icon">üìù</div>
                <h2 class="card-title">Basic Information</h2>
              </div>
              <div class="card-content">
                <div class="form-grid">
                  <div class="form-group">
                    <label for="fullName" class="form-label">
                      <strong>Full Name *</strong>
                    </label>
                    <input
                      id="fullName"
                      type="text"
                      class="form-input"
                      [class.error]="fullNameInvalid"
                      formControlName="fullName"
                      placeholder="Ingresa tu nombre completo">
                    <div class="error-message" *ngIf="fullNameInvalid">
                      El nombre es requerido y debe tener al menos 2 caracteres
                    </div>
                  </div>

                  <div class="form-group">
                    <label for="email" class="form-label">
                      <strong>Correo Electr√≥nico *</strong>
                    </label>
                    <input
                      id="email"
                      type="email"
                      class="form-input"
                      [class.error]="emailInvalid"
                      formControlName="email"
                      placeholder="correo@ejemplo.com">
                    <div class="error-message" *ngIf="emailInvalid">
                      Ingresa un correo electr√≥nico v√°lido
                    </div>
                  </div>

                  <div class="form-group">
                    <label for="currentPassword" class="form-label">
                      <strong>Contrase√±a Actual</strong>
                    </label>
                    <input
                      id="currentPassword"
                      type="password"
                      class="form-input"
                      formControlName="currentPassword"
                      placeholder="Contrase√±a actual">
                  </div>

                  <div class="form-group">
                    <label for="newPassword" class="form-label">
                      <strong>Nueva Contrase√±a</strong>
                    </label>
                    <input
                      id="newPassword"
                      type="password"
                      class="form-input"
                      [class.error]="newPasswordInvalid"
                      formControlName="newPassword"
                      placeholder="Nueva contrase√±a (min. 6 caracteres)">
                    <div class="error-message" *ngIf="newPasswordInvalid">
                      La contrase√±a debe tener al menos 6 caracteres
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Learning Information -->
            <div class="config-card">
              <div class="card-header">
                <div class="card-icon">üìö</div>
                <h2 class="card-title">Learning Information</h2>
              </div>
              <div class="card-content">
                <div class="form-group">
                  <label for="currentLevel" class="form-label">
                    <strong>Current English Level *</strong>
                  </label>
                  <select id="currentLevel" class="form-select" formControlName="currentLevel">
                    <option *ngFor="let level of englishLevels" [value]="level.value">
                      {{ level.label }}
                    </option>
                  </select>
                </div>

                <div class="form-group">
                  <label class="form-label">
                    <strong>Study Topics</strong>
                  </label>
                  <div class="checkbox-grid">
                    <label *ngFor="let topic of studyTopicsOptions" class="checkbox-item">
                      <input
                        type="checkbox"
                        [checked]="isTopicSelected(topic.value)"
                        (change)="onTopicChange(topic.value)">
                      <span class="checkbox-label">{{ topic.label }}</span>
                    </label>
                  </div>
                </div>

                <div class="form-group">
                  <label class="form-label">
                    <strong>Learning Goals</strong>
                  </label>
                  <div class="checkbox-grid">
                    <label *ngFor="let goal of learningGoalsOptions" class="checkbox-item">
                      <input
                        type="checkbox"
                        [checked]="isGoalSelected(goal.value)"
                        (change)="onGoalChange(goal.value)">
                      <span class="checkbox-label">{{ goal.label }}</span>
                    </label>
                  </div>
                </div>
              </div>
            </div>

            <!-- Account Settings -->
            <div class="config-card">
              <div class="card-header">
                <div class="card-icon">‚öôÔ∏è</div>
                <h2 class="card-title">Account Settings</h2>
              </div>
              <div class="card-content">
                <div class="form-grid">
                  <div class="form-group">
                    <label for="interfaceLanguage" class="form-label">
                      <strong>Interface Language *</strong>
                    </label>
                    <select id="interfaceLanguage" class="form-select" formControlName="interfaceLanguage">
                      <option *ngFor="let lang of interfaceLanguages" [value]="lang.value">
                        {{ lang.label }}
                      </option>
                    </select>
                  </div>

                  <div class="form-group">
                    <label for="timeZone" class="form-label">
                      <strong>Time Zone *</strong>
                    </label>
                    <select id="timeZone" class="form-select" formControlName="timeZone">
                      <option *ngFor="let tz of timeZones" [value]="tz.value">
                        {{ tz.label }}
                      </option>
                    </select>
                  </div>
                </div>
              </div>
            </div>

            <div class="form-actions">
              <button 
                type="submit" 
                class="btn btn-primary btn-large"
                [disabled]="profileForm.invalid || isLoading">
                <span *ngIf="isLoading" class="loading-spinner"></span>
                {{ isLoading ? 'Saving...' : 'Save Changes' }}
              </button>
            </div>
          </form>
        </div>

        <!-- Accessibility Content -->
        <div *ngIf="activeSection === 'accesibilidad'">
          <!-- Text Size -->
          <div class="config-card">
            <div class="card-header">
              <div class="card-icon">üî†</div>
              <h2 class="card-title">Text Size</h2>
            </div>
            <div class="card-content">
              <div class="accessibility-option">
                <div class="option-icon">
                  <span class="text-size-demo">Aa</span>
                </div>
                <div class="option-content">
                  <p>Select the most comfortable font size for you.</p>
                  <div class="radio-group">
                    <label *ngFor="let size of fontSizes" class="radio-item">
                      <input 
                        type="radio" 
                        name="fontSize"
                        [value]="size.value"
                        [checked]="accessibilitySettings.fontSize === size.value"
                        (change)="onFontSizeChange(size.value)">
                      <span class="radio-label">{{ size.label }}</span>
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- High Contrast -->
          <div class="config-card">
            <div class="card-header">
              <div class="card-icon">üîÜ</div>
              <h2 class="card-title">High Contrast</h2>
            </div>
            <div class="card-content">
              <div class="accessibility-option">
                <div class="option-icon">
                  <span class="contrast-icon">üí°</span>
                </div>
                <div class="option-content">
                  <p>Improve readability by increasing color contrast.</p>
                  <div class="toggle-container">
                    <label class="toggle-switch">
                      <input 
                        type="checkbox"
                        [checked]="accessibilitySettings.highContrast"
                        (change)="onHighContrastToggle()">
                      <span class="slider"></span>
                    </label>
                    <span class="toggle-label">
                      {{ accessibilitySettings.highContrast ? 'Activado' : 'Desactivado' }}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Modo Oscuro/Claro -->
          <div class="config-card">
            <div class="card-header">
              <div class="card-icon">üåì</div>
              <h2 class="card-title">Modo Oscuro</h2>
            </div>
            <div class="card-content">
              <div class="accessibility-option">
                <div class="option-icon">
                  <div class="theme-preview">
                    <div class="theme-light" [class.active]="!accessibilitySettings.darkMode"></div>
                    <div class="theme-dark" [class.active]="accessibilitySettings.darkMode"></div>
                  </div>
                </div>
                <div class="option-content">
                  <p>Cambia entre tema claro y oscuro para reducir la fatiga visual.</p>
                  <div class="toggle-container">
                    <label class="toggle-switch">
                      <input 
                        type="checkbox"
                        [checked]="accessibilitySettings.darkMode"
                        (change)="onDarkModeToggle()">
                      <span class="slider"></span>
                    </label>
                    <span class="toggle-label">
                      {{ accessibilitySettings.darkMode ? 'Modo Oscuro' : 'Modo Claro' }}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Contenido de Notificaciones -->
        <div *ngIf="activeSection === 'notificaciones'">
          <!-- Recordatorios de Estudio -->
          <div class="config-card">
            <div class="card-header">
              <div class="card-icon">üìö</div>
              <h2 class="card-title">Recordatorios de Estudio</h2>
            </div>
            <div class="card-content">
              <div class="notification-option">
                <div class="option-icon">
                  <span class="reminder-icon">üìñ‚è∞</span>
                </div>
                <div class="option-content">
                  <div class="toggle-container">
                    <label class="toggle-switch">
                      <input 
                        type="checkbox"
                        [checked]="notificationSettings.studyReminders.enabled"
                        (change)="onStudyRemindersToggle()">
                      <span class="slider"></span>
                    </label>
                    <span class="toggle-label">
                      {{ notificationSettings.studyReminders.enabled ? 'Activado' : 'Desactivado' }}
                    </span>
                  </div>

                  <div *ngIf="notificationSettings.studyReminders.enabled" class="reminder-settings">
                    <div class="form-group">
                      <label class="form-label"><strong>Frecuencia:</strong></label>
                      <select 
                        class="form-select"
                        [value]="notificationSettings.studyReminders.frequency"
                        (change)="onReminderFrequencyChange($event)">
                        <option *ngFor="let freq of reminderFrequencies" [value]="freq.value">
                          {{ freq.label }}
                        </option>
                      </select>
                    </div>

                    <div class="form-group">
                      <label class="form-label"><strong>Hora del D√≠a:</strong></label>
                      <input 
                        type="time"
                        class="form-input"
                        [value]="notificationSettings.studyReminders.time"
                        (change)="onReminderTimeChange($event)">
                    </div>

                    <div class="form-group">
                      <label class="form-label"><strong>D√≠as de la Semana:</strong></label>
                      <div class="checkbox-grid days-grid">
                        <label *ngFor="let day of daysOfWeek" class="checkbox-item day-item">
                          <input
                            type="checkbox"
                            [checked]="isDaySelected(day.value)"
                            (change)="onDayOfWeekToggle(day.value)">
                          <span class="checkbox-label">{{ day.label }}</span>
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Progreso y Logros -->
          <div class="config-card">
            <div class="card-header">
              <div class="card-icon">üèÜ</div>
              <h2 class="card-title">Progreso y Logros</h2>
            </div>
            <div class="card-content">
              <div class="notification-option">
                <div class="option-icon">
                  <span class="trophy-icon">üèÜ</span>
                </div>
                <div class="option-content">
                  <p>Recibe notificaciones sobre tu progreso semanal y hitos alcanzados.</p>
                  <div class="toggle-container">
                    <label class="toggle-switch">
                      <input 
                        type="checkbox"
                        [checked]="notificationSettings.progressNotifications"
                        (change)="onProgressNotificationsToggle()">
                      <span class="slider"></span>
                    </label>
                    <span class="toggle-label">
                      {{ notificationSettings.progressNotifications ? 'Activado' : 'Desactivado' }}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Promociones/Actualizaciones -->
          <div class="config-card">
            <div class="card-header">
              <div class="card-icon">üéâ</div>
              <h2 class="card-title">Promociones y Actualizaciones</h2>
            </div>
            <div class="card-content">
              <div class="notification-option">
                <div class="option-icon">
                  <span class="promo-icon">üè∑Ô∏è‚öôÔ∏è</span>
                </div>
                <div class="option-content">
                  <p>Recibe noticias sobre ofertas especiales y nuevas caracter√≠sticas de la aplicaci√≥n.</p>
                  <div class="toggle-container">
                    <label class="toggle-switch">
                      <input 
                        type="checkbox"
                        [checked]="notificationSettings.promotionalNotifications"
                        (change)="onPromotionalNotificationsToggle()">
                      <span class="slider"></span>
                    </label>
                    <span class="toggle-label">
                      {{ notificationSettings.promotionalNotifications ? 'Activado' : 'Desactivado' }}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Contenido de Preferencias -->
        <div *ngIf="activeSection === 'preferencias'">
          <!-- Tipo de Contenido Preferido -->
          <div class="config-card">
            <div class="card-header">
              <div class="card-icon">üì±</div>
              <h2 class="card-title">Tipo de Contenido Preferido</h2>
            </div>
            <div class="card-content">
              <div class="preference-option">
                <div class="option-icon">
                  <span class="content-icon">üìä</span>
                </div>
                <div class="option-content">
                  <p>Selecciona los formatos de aprendizaje que m√°s te gustan.</p>
                  <div class="checkbox-grid">
                    <label *ngFor="let content of contentTypesOptions" class="checkbox-item">
                      <input
                        type="checkbox"
                        [checked]="isContentTypeSelected(content.value)"
                        (change)="onContentTypeToggle(content.value)">
                      <span class="checkbox-label">{{ content.label }}</span>
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Dificultad de los Ejercicios -->
          <div class="config-card">
            <div class="card-header">
              <div class="card-icon">üéØ</div>
              <h2 class="card-title">Dificultad de los Ejercicios</h2>
            </div>
            <div class="card-content">
              <div class="preference-option">
                <div class="option-icon">
                  <span class="difficulty-icon">üé≤</span>
                </div>
                <div class="option-content">
                  <p>Ajusta la dificultad de los ejercicios seg√∫n tu preferencia.</p>
                  <div class="radio-group">
                    <label *ngFor="let difficulty of difficultyLevels" class="radio-item">
                      <input 
                        type="radio" 
                        name="exerciseDifficulty"
                        [value]="difficulty.value"
                        [checked]="preferenceSettings.exerciseDifficulty === difficulty.value"
                        (change)="onDifficultyChange(difficulty.value)">
                      <span class="radio-label">{{ difficulty.label }}</span>
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Temas Excluidos -->
          <div class="config-card">
            <div class="card-header">
              <div class="card-icon">üö´</div>
              <h2 class="card-title">Temas Excluidos</h2>
            </div>
            <div class="card-content">
              <div class="preference-option">
                <div class="option-icon">
                  <span class="exclude-icon">üö∑</span>
                </div>
                <div class="option-content">
                  <p>Especifica temas que no deseas ver en tu contenido de estudio.</p>
                  
                  <div class="excluded-topics-input">
                    <input 
                      type="text" 
                      #excludeTopicInput
                      class="form-input" 
                      placeholder="Escribe un tema a excluir..."
                      (keyup.enter)="onExcludedTopicAdd(excludeTopicInput.value); excludeTopicInput.value = ''">
                    <button 
                      type="button" 
                      class="btn btn-secondary btn-small"
                      (click)="onExcludedTopicAdd(excludeTopicInput.value); excludeTopicInput.value = ''">
                      Agregar
                    </button>
                  </div>

                  <div class="excluded-topics-list" *ngIf="preferenceSettings.excludedTopics.length > 0">
                    <div *ngFor="let topic of preferenceSettings.excludedTopics" class="excluded-topic-tag">
                      <span class="topic-text">{{ topic }}</span>
                      <button 
                        type="button" 
                        class="remove-topic-btn"
                        (click)="onExcludedTopicRemove(topic)"
                        aria-label="Eliminar tema">
                        √ó
                      </button>
                    </div>
                  </div>

                  <p class="helper-text" *ngIf="preferenceSettings.excludedTopics.length === 0">
                    No has excluido ning√∫n tema a√∫n.
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>
</main>