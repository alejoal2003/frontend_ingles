<!-- Header -->
<header class="header" role="banner">
  <div class="container">
    <div class="header-content">
      <div class="logo">
        <span class="logo-icon">📚</span>
        <span class="logo-text">EnglishMaster</span>
      </div>
      <div class="header-actions">
        <button 
          class="btn btn-outline" 
          (click)="navigateToProfile()"
          type="button"
          aria-label="Go to user profile">
          <span aria-hidden="true">👤</span> Profile
        </button>
        <button 
          class="btn btn-primary" 
          (click)="logout()"
          type="button"
          aria-label="Log out and exit the application">
          Exit
        </button>
      </div>
    </div>
  </div>
</header>
<nav class="top-nav">
      <button type="button" class="nav-item" (click)="navigateToSection('inicio')" aria-label="Go to Home">
          <div class="nav-icon">🏠</div>
          <div class="nav-text">Home</div>
      </button>
      <button type="button" class="nav-item" (click)="navigateToSection('lecturas')" aria-label="Go to Reading">
          <div class="nav-icon">📖</div>
          <div class="nav-text">Reading</div>
      </button>
      <button type="button" class="nav-item" (click)="navigateToSection('musica')" aria-label="Go to Music">
          <div class="nav-icon">🎵</div>
          <div class="nav-text">Music</div>
      </button>
      <button type="button" class="nav-item" (click)="navigateToSection('progreso')" aria-label="Go to Progress">
          <div class="nav-icon">📊</div>
          <div class="nav-text">Progress</div>
      </button>
      <button type="button" class="nav-item active" (click)="navigateToSection('lecciones')" aria-label="Go to Lessons">
          <div class="nav-icon">📚</div>
          <div class="nav-text">Lessons</div>
      </button>
      <button type="button" class="nav-item" (click)="navigateToSection('config')" aria-label="Go to Settings">
          <div class="nav-icon">⚙️</div>
          <div class="nav-text">Settings</div>
      </button>
  </nav>
<!-- Success Message -->
<div class="success-message" [class.show]="showSaveMessage">
  <div class="success-content">
    <span class="success-icon">✅</span>
    <span class="success-text">{{ saveMessage }}</span>
  </div>
</div>

<main class="main">
  <div class="container">
    <div class="config-layout">
      <!-- Side Panel -->
      <aside class="sidebar">
        <div class="profile-section">
          <div class="profile-avatar">
            <span class="avatar-icon">👤</span>
          </div>
          <button 
            class="sidebar-btn" 
            [class.active]="isActiveSection('perfil')"
            (click)="setActiveSection('perfil')">
            Edit Profile
          </button>
          <button 
            class="sidebar-btn" 
            [class.active]="isActiveSection('accesibilidad')"
            (click)="setActiveSection('accesibilidad')">
            Accessibility
          </button>
          <button 
            class="sidebar-btn" 
            [class.active]="isActiveSection('notificaciones')"
            (click)="setActiveSection('notificaciones')">
            Notifications
          </button>
          <button 
            class="sidebar-btn" 
            [class.active]="isActiveSection('preferencias')"
            (click)="setActiveSection('preferencias')">
            Preferences
          </button>
        </div>
      </aside>

      <!-- Main Content -->
      <section class="main-content">
        <h1 class="page-title">
          <span class="title-icon">⚙️</span>
          User Settings
        </h1>
        
        <!-- Profile Content -->
        <div *ngIf="activeSection === 'perfil'">
          <form [formGroup]="profileForm" (ngSubmit)="onProfileSubmit()">
            <!-- Basic Information -->
            <div class="config-card">
              <div class="card-header">
                <div class="card-icon">📝</div>
                <h2 class="card-title">Basic Information</h2>
              </div>
              <div class="card-content">
                <div class="form-grid">
                  <div class="form-group">
                    <label for="fullName" class="form-label">
                      <strong>Full Name *</strong>
                    </label>
                    <input
                      id="fullName"
                      type="text"
                      class="form-input"
                      [class.error]="fullNameInvalid"
                      formControlName="fullName"
                      placeholder="Enter your full name">
                    <div class="error-message" *ngIf="fullNameInvalid">
                      Full name is required and must be at least 2 characters
                    </div>
                  </div>

                  <div class="form-group">
                    <label for="email" class="form-label">
                      <strong>Email Address *</strong>
                    </label>
                    <input
                      id="email"
                      type="email"
                      class="form-input"
                      [class.error]="emailInvalid"
                      formControlName="email"
                      placeholder="email@example.com">
                    <div class="error-message" *ngIf="emailInvalid">
                      Please enter a valid email address
                    </div>
                  </div>

                  <div class="form-group">
                    <label for="currentPassword" class="form-label">
                      <strong>Current Password</strong>
                    </label>
                    <input
                      id="currentPassword"
                      type="password"
                      class="form-input"
                      formControlName="currentPassword"
                      placeholder="Current password">
                  </div>

                  <div class="form-group">
                    <label for="newPassword" class="form-label">
                      <strong>New Password</strong>
                    </label>
                    <input
                      id="newPassword"
                      type="password"
                      class="form-input"
                      [class.error]="newPasswordInvalid"
                      formControlName="newPassword"
                      placeholder="New password (min. 6 characters)">
                    <div class="error-message" *ngIf="newPasswordInvalid">
                      Password must be at least 6 characters long
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Learning Information -->
            <div class="config-card">
              <div class="card-header">
                <div class="card-icon">📚</div>
                <h2 class="card-title">Learning Information</h2>
              </div>
              <div class="card-content">
                <div class="form-group">
                  <label for="currentLevel" class="form-label">
                    <strong>Current English Level *</strong>
                  </label>
                  <select id="currentLevel" class="form-select" formControlName="currentLevel">
                    <option *ngFor="let level of englishLevels" [value]="level.value">
                      {{ level.label }}
                    </option>
                  </select>
                </div>

                <div class="form-group">
                  <label class="form-label">
                    <strong>Study Topics</strong>
                  </label>
                  <div class="checkbox-grid">
                    <label *ngFor="let topic of studyTopicsOptions" class="checkbox-item">
                      <input
                        type="checkbox"
                        [checked]="isTopicSelected(topic.value)"
                        (change)="onTopicChange(topic.value)">
                      <span class="checkbox-label">{{ topic.label }}</span>
                    </label>
                  </div>
                </div>

                <div class="form-group">
                  <label class="form-label">
                    <strong>Learning Goals</strong>
                  </label>
                  <div class="checkbox-grid">
                    <label *ngFor="let goal of learningGoalsOptions" class="checkbox-item">
                      <input
                        type="checkbox"
                        [checked]="isGoalSelected(goal.value)"
                        (change)="onGoalChange(goal.value)">
                      <span class="checkbox-label">{{ goal.label }}</span>
                    </label>
                  </div>
                </div>
              </div>
            </div>

            <!-- Account Settings -->
            <div class="config-card">
              <div class="card-header">
                <div class="card-icon">⚙️</div>
                <h2 class="card-title">Account Settings</h2>
              </div>
              <div class="card-content">
                <div class="form-grid">
                  <div class="form-group">
                    <label for="interfaceLanguage" class="form-label">
                      <strong>Interface Language *</strong>
                    </label>
                    <select id="interfaceLanguage" class="form-select" formControlName="interfaceLanguage">
                      <option *ngFor="let lang of interfaceLanguages" [value]="lang.value">
                        {{ lang.label }}
                      </option>
                    </select>
                  </div>

                  <div class="form-group">
                    <label for="timeZone" class="form-label">
                      <strong>Time Zone *</strong>
                    </label>
                    <select id="timeZone" class="form-select" formControlName="timeZone">
                      <option *ngFor="let tz of timeZones" [value]="tz.value">
                        {{ tz.label }}
                      </option>
                    </select>
                  </div>
                </div>
              </div>
            </div>

            <div class="form-actions">
              <button 
                type="submit" 
                class="btn btn-primary btn-large"
                [disabled]="profileForm.invalid || isLoading">
                <span *ngIf="isLoading" class="loading-spinner"></span>
                {{ isLoading ? 'Saving...' : 'Save Changes' }}
              </button>
            </div>
          </form>
        </div>

        <!-- Accessibility Content -->
        <div *ngIf="activeSection === 'accesibilidad'">
          <!-- Text Size -->
          <div class="config-card">
            <div class="card-header">
              <div class="card-icon">🔠</div>
              <h2 class="card-title">Text Size</h2>
            </div>
            <div class="card-content">
              <div class="accessibility-option">
                <div class="option-icon">
                  <span class="text-size-demo">Aa</span>
                </div>
                <div class="option-content">
                  <p>Select the most comfortable font size for you.</p>
                  <div class="radio-group">
                    <label *ngFor="let size of fontSizes" class="radio-item">
                      <input 
                        type="radio" 
                        name="fontSize"
                        [value]="size.value"
                        [checked]="accessibilitySettings.fontSize === size.value"
                        (change)="onFontSizeChange(size.value)">
                      <span class="radio-label">{{ size.label }}</span>
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- High Contrast -->
          <div class="config-card">
            <div class="card-header">
              <div class="card-icon">🔆</div>
              <h2 class="card-title">High Contrast</h2>
            </div>
            <div class="card-content">
              <div class="accessibility-option">
                <div class="option-icon">
                  <span class="contrast-icon">💡</span>
                </div>
                <div class="option-content">
                  <p>Improve readability by increasing color contrast.</p>
                  <div class="toggle-container">
                    <label class="toggle-switch">
                      <input 
                        type="checkbox"
                        [checked]="accessibilitySettings.highContrast"
                        (change)="onHighContrastToggle()">
                      <span class="slider"></span>
                    </label>
                    <span class="toggle-label">
                      {{ accessibilitySettings.highContrast ? 'Enabled' : 'Disabled' }}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Dark/Light Mode -->
          <div class="config-card">
            <div class="card-header">
              <div class="card-icon">🌓</div>
              <h2 class="card-title">Dark Mode</h2>
            </div>
            <div class="card-content">
              <div class="accessibility-option">
                <div class="option-icon">
                  <div class="theme-preview">
                    <div class="theme-light" [class.active]="!accessibilitySettings.darkMode"></div>
                    <div class="theme-dark" [class.active]="accessibilitySettings.darkMode"></div>
                  </div>
                </div>
                <div class="option-content">
                  <p>Switch between light and dark theme to reduce eye strain.</p>
                  <div class="toggle-container">
                    <label class="toggle-switch">
                      <input 
                        type="checkbox"
                        [checked]="accessibilitySettings.darkMode"
                        (change)="onDarkModeToggle()">
                      <span class="slider"></span>
                    </label>
                    <span class="toggle-label">
                      {{ accessibilitySettings.darkMode ? 'Dark Mode' : 'Light Mode' }}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Notifications Content -->
        <div *ngIf="activeSection === 'notificaciones'">
          <!-- Study Reminders -->
          <div class="config-card">
            <div class="card-header">
              <div class="card-icon">📚</div>
              <h2 class="card-title">Study Reminders</h2>
            </div>
            <div class="card-content">
              <div class="notification-option">
                <div class="option-icon">
                  <span class="reminder-icon">📖⏰</span>
                </div>
                <div class="option-content">
                  <div class="toggle-container">
                    <label class="toggle-switch">
                      <input 
                        type="checkbox"
                        [checked]="notificationSettings.studyReminders.enabled"
                        (change)="onStudyRemindersToggle()">
                      <span class="slider"></span>
                    </label>
                    <span class="toggle-label">
                      {{ notificationSettings.studyReminders.enabled ? 'Enabled' : 'Disabled' }}
                    </span>
                  </div>

                  <div *ngIf="notificationSettings.studyReminders.enabled" class="reminder-settings">
                    <div class="form-group">
                      <label class="form-label"><strong>Frequency:</strong></label>
                      <select 
                        class="form-select"
                        [value]="notificationSettings.studyReminders.frequency"
                        (change)="onReminderFrequencyChange($event)">
                        <option *ngFor="let freq of reminderFrequencies" [value]="freq.value">
                          {{ freq.label }}
                        </option>
                      </select>
                    </div>

                    <div class="form-group">
                      <label class="form-label"><strong>Time of Day:</strong></label>
                      <input 
                        type="time"
                        class="form-input"
                        [value]="notificationSettings.studyReminders.time"
                        (change)="onReminderTimeChange($event)">
                    </div>

                    <div class="form-group">
                      <label class="form-label"><strong>Days of the Week:</strong></label>
                      <div class="checkbox-grid days-grid">
                        <label *ngFor="let day of daysOfWeek" class="checkbox-item day-item">
                          <input
                            type="checkbox"
                            [checked]="isDaySelected(day.value)"
                            (change)="onDayOfWeekToggle(day.value)">
                          <span class="checkbox-label">{{ day.label }}</span>
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Progress and Achievements -->
          <div class="config-card">
            <div class="card-header">
              <div class="card-icon">🏆</div>
              <h2 class="card-title">Progress and Achievements</h2>
            </div>
            <div class="card-content">
              <div class="notification-option">
                <div class="option-icon">
                  <span class="trophy-icon">🏆</span>
                </div>
                <div class="option-content">
                  <p>Receive notifications about your weekly progress and milestones achieved.</p>
                  <div class="toggle-container">
                    <label class="toggle-switch">
                      <input 
                        type="checkbox"
                        [checked]="notificationSettings.progressNotifications"
                        (change)="onProgressNotificationsToggle()">
                      <span class="slider"></span>
                    </label>
                    <span class="toggle-label">
                      {{ notificationSettings.progressNotifications ? 'Enabled' : 'Disabled' }}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Promotions/Updates -->
          <div class="config-card">
            <div class="card-header">
              <div class="card-icon">🎉</div>
              <h2 class="card-title">Promotions and Updates</h2>
            </div>
            <div class="card-content">
              <div class="notification-option">
                <div class="option-icon">
                  <span class="promo-icon">🏷️⚙️</span>
                </div>
                <div class="option-content">
                  <p>Receive news about special offers and new app features.</p>
                  <div class="toggle-container">
                    <label class="toggle-switch">
                      <input 
                        type="checkbox"
                        [checked]="notificationSettings.promotionalNotifications"
                        (change)="onPromotionalNotificationsToggle()">
                      <span class="slider"></span>
                    </label>
                    <span class="toggle-label">
                      {{ notificationSettings.promotionalNotifications ? 'Enabled' : 'Disabled' }}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Preferences Content -->
        <div *ngIf="activeSection === 'preferencias'">
          <!-- Preferred Content Type -->
          <div class="config-card">
            <div class="card-header">
              <div class="card-icon">📱</div>
              <h2 class="card-title">Preferred Content Type</h2>
            </div>
            <div class="card-content">
              <div class="preference-option">
                <div class="option-icon">
                  <span class="content-icon">📊</span>
                </div>
                <div class="option-content">
                  <p>Select the learning formats you enjoy most.</p>
                  <div class="checkbox-grid">
                    <label *ngFor="let content of contentTypesOptions" class="checkbox-item">
                      <input
                        type="checkbox"
                        [checked]="isContentTypeSelected(content.value)"
                        (change)="onContentTypeToggle(content.value)">
                      <span class="checkbox-label">{{ content.label }}</span>
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Exercise Difficulty -->
          <div class="config-card">
            <div class="card-header">
              <div class="card-icon">🎯</div>
              <h2 class="card-title">Exercise Difficulty</h2>
            </div>
            <div class="card-content">
              <div class="preference-option">
                <div class="option-icon">
                  <span class="difficulty-icon">🎲</span>
                </div>
                <div class="option-content">
                  <p>Adjust the exercise difficulty according to your preference.</p>
                  <div class="radio-group">
                    <label *ngFor="let difficulty of difficultyLevels" class="radio-item">
                      <input 
                        type="radio" 
                        name="exerciseDifficulty"
                        [value]="difficulty.value"
                        [checked]="preferenceSettings.exerciseDifficulty === difficulty.value"
                        (change)="onDifficultyChange(difficulty.value)">
                      <span class="radio-label">{{ difficulty.label }}</span>
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Excluded Topics -->
          <div class="config-card">
            <div class="card-header">
              <div class="card-icon">🚫</div>
              <h2 class="card-title">Excluded Topics</h2>
            </div>
            <div class="card-content">
              <div class="preference-option">
                <div class="option-icon">
                  <span class="exclude-icon">🚷</span>
                </div>
                <div class="option-content">
                  <p>Specify topics you don't want to see in your study content.</p>
                  
                  <div class="excluded-topics-input">
                    <input 
                      type="text" 
                      #excludeTopicInput
                      class="form-input" 
                      placeholder="Enter a topic to exclude..."
                      (keyup.enter)="onExcludedTopicAdd(excludeTopicInput.value); excludeTopicInput.value = ''">
                    <button 
                      type="button" 
                      class="btn btn-secondary btn-small"
                      (click)="onExcludedTopicAdd(excludeTopicInput.value); excludeTopicInput.value = ''">
                      Add
                    </button>
                  </div>

                  <div class="excluded-topics-list" *ngIf="preferenceSettings.excludedTopics.length > 0">
                    <div *ngFor="let topic of preferenceSettings.excludedTopics" class="excluded-topic-tag">
                      <span class="topic-text">{{ topic }}</span>
                      <button 
                        type="button" 
                        class="remove-topic-btn"
                        (click)="onExcludedTopicRemove(topic)"
                        aria-label="Remove topic">
                        ×
                      </button>
                    </div>
                  </div>

                  <p class="helper-text" *ngIf="preferenceSettings.excludedTopics.length === 0">
                    You haven't excluded any topics yet.
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>
</main>