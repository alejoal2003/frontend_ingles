<!-- Header -->
<header class="header" role="banner">
    <div class="container">
        <div class="header-content">
            <h1 class="logo" tabindex="1">
                <span class="sr-only">EnglishMaster - English learning application</span>
                <span aria-hidden="true">EnglishMaster</span>
            </h1>
            <div class="header-actions" role="toolbar" aria-label="User actions">
                <button 
                    class="btn btn-secondary" 
                    (click)="navigateToProfile()" 
                    type="button"
                    tabindex="2"
                    aria-label="Go to user profile">
                    <span aria-hidden="true">ğŸ‘¤</span> Profile
                </button>
                <button 
                    class="btn btn-primary" 
                    (click)="logout()" 
                    type="button"
                    tabindex="3"
                    aria-label="Log out and exit the application">
                    Logout
                </button>
            </div>
        </div>
    </div>
</header>

<!-- Navigation -->
<nav class="nav" role="navigation" aria-label="Main navigation">
    <div class="container">
        <div class="nav-container" role="menubar">
            <button 
                type="button" 
                class="nav-item" 
                (click)="navigateToSection('inicio')" 
                role="menuitem"
                tabindex="4" 
                aria-label="Go to Home section">
                <span class="nav-icon" aria-hidden="true">ğŸ </span>
                <span class="nav-text">Home</span>
            </button>
            <button 
                type="button" 
                class="nav-item" 
                (click)="navigateToSection('lectura')"
                role="menuitem"
                tabindex="5" 
                aria-label="Go to Reading section">
                <span class="nav-icon" aria-hidden="true">ğŸ“–</span>
                <span class="nav-text">Readings</span>
            </button>
            <button 
                type="button" 
                class="nav-item" 
                (click)="navigateToSection('musica')" 
                role="menuitem"
                tabindex="6" 
                aria-label="Go to Music section">
                <span class="nav-icon" aria-hidden="true">ğŸµ</span>
                <span class="nav-text">Music</span>
            </button>
            <button 
                type="button" 
                class="nav-item active" 
                (click)="navigateToSection('progreso')" 
                role="menuitem"
                tabindex="7" 
                aria-label="Current section: Progress"
                aria-current="page"
                aria-pressed="true">
                <span class="nav-icon" aria-hidden="true">ğŸ“Š</span>
                <span class="nav-text">Progress</span>
            </button>
            <button 
                type="button" 
                class="nav-item" 
                (click)="navigateToSection('lecciones')" 
                role="menuitem"
                tabindex="8" 
                aria-label="Go to Lessons section">
                <span class="nav-icon" aria-hidden="true">ğŸ“š</span>
                <span class="nav-text">Lessons</span>
            </button>
            <button 
                type="button" 
                class="nav-item" 
                (click)="navigateToSection('config')" 
                role="menuitem"
                tabindex="9" 
                aria-label="Go to Settings section">
                <span class="nav-icon" aria-hidden="true">âš™ï¸</span>
                <span class="nav-text">Settings</span>
            </button>
        </div>
    </div>
</nav>

<main class="main">
    <div class="container">
        <div class="progress-container" *ngIf="progressStats">
            <div class="progress-header">
                <div class="progress-icon">ğŸ“ˆ</div>
                <h2 class="progress-title">Your Progress</h2>
            </div>
            
            <div class="progress-content">
                <div class="stats-section">
                    <div class="stat-card">
                        <div class="stat-icon">â°</div>
                        <div class="stat-info">
                            <div class="stat-number">{{formatStudyHours()}}</div>
                            <div class="stat-label">Study Hours</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ“š</div>
                        <div class="stat-info">
                            <div class="stat-number">{{progressStats.wordsLearned}}</div>
                            <div class="stat-label">Words Learned</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">âœ…</div>
                        <div class="stat-info">
                            <div class="stat-number">{{progressStats.lessonsCompleted}}</div>
                            <div class="stat-label">Lessons Completed</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ¯</div>
                        <div class="stat-info">
                            <div class="stat-number">{{progressStats.averageAccuracy}}%</div>
                            <div class="stat-label">Average Accuracy</div>
                        </div>
                    </div>
                </div>

                <div class="right-panel">
                    <div class="chart-container">
                        <div class="chart-title">Weekly Study Time</div>
                        <div class="bar-chart">
                            <div 
                                *ngFor="let week of getWeeklyChartData()" 
                                class="bar" 
                                [style.height]="getBarHeight(week.hours)"
                                [title]="'Week: ' + (week.hours || 0) + ' hours'">
                            </div>
                        </div>
                        <div class="chart-labels">
                            <span *ngFor="let week of getWeeklyChartData()">
                                {{(week.hours || 0).toFixed(1)}}h
                            </span>
                        </div>
                    </div>

                    <div class="study-streak-card">
                        <div class="streak-icon">ğŸ”¥</div>
                        <div class="streak-number">{{progressStats.currentStreak}}</div>
                        <div class="streak-label">Consecutive study days</div>
                    </div>

                    <div class="goals-achievements">
                        <div class="goals-card" (click)="navigateToSection('lecciones')">
                            <div class="card-icon">ğŸ¯</div>
                            <span>Weekly Goals</span>
                        </div>
                        <div class="achievements-card" (click)="navigateToSection('lecciones')">
                            <div class="card-icon">ğŸ†</div>
                            <span>Achievements & Badges</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Lesson progress section -->
            <div class="lesson-stats-section">
                <h3 class="section-title">Performance by Lesson</h3>
                <div class="lesson-stats-grid">
                    <div class="lesson-stat-card" (click)="startLesson('grammar')">
                        <div class="lesson-icon">ğŸ“</div>
                        <div class="lesson-info">
                            <h4>Grammar</h4>
                            <div class="lesson-metrics">
                                <div class="metric">
                                    <span class="metric-label">Average:</span>
                                    <span class="metric-value">{{getGrammarStats().averageScore}}%</span>
                                </div>
                                <div class="metric">
                                    <span class="metric-label">Completed:</span>
                                    <span class="metric-value">{{getGrammarStats().totalCompleted}}</span>
                                </div>
                                <div class="metric">
                                    <span class="metric-label">Best:</span>
                                    <span class="metric-value">{{getGrammarStats().bestScore}}%</span>
                                </div>
                            </div>
                        </div>
                        <div class="lesson-action">â†’</div>
                    </div>

                    <div class="lesson-stat-card" (click)="startLesson('listening')">
                        <div class="lesson-icon">ğŸ§</div>
                        <div class="lesson-info">
                            <h4>Listening</h4>
                            <div class="lesson-metrics">
                                <div class="metric">
                                    <span class="metric-label">Average:</span>
                                    <span class="metric-value">{{getListeningStats().averageScore}}%</span>
                                </div>
                                <div class="metric">
                                    <span class="metric-label">Completed:</span>
                                    <span class="metric-value">{{getListeningStats().totalCompleted}}</span>
                                </div>
                                <div class="metric">
                                    <span class="metric-label">Best:</span>
                                    <span class="metric-value">{{getListeningStats().bestScore}}%</span>
                                </div>
                            </div>
                        </div>
                        <div class="lesson-action">â†’</div>
                    </div>

                    <div class="lesson-stat-card" (click)="startLesson('vocabulary')">
                        <div class="lesson-icon">ğŸ“–</div>
                        <div class="lesson-info">
                            <h4>Vocabulary</h4>
                            <div class="lesson-metrics">
                                <div class="metric">
                                    <span class="metric-label">Average:</span>
                                    <span class="metric-value">{{getVocabularyStats().averageScore}}%</span>
                                </div>
                                <div class="metric">
                                    <span class="metric-label">Completed:</span>
                                    <span class="metric-value">{{getVocabularyStats().totalCompleted}}</span>
                                </div>
                                <div class="metric">
                                    <span class="metric-label">Best:</span>
                                    <span class="metric-value">{{getVocabularyStats().bestScore}}%</span>
                                </div>
                            </div>
                        </div>
                        <div class="lesson-action">â†’</div>
                    </div>
                </div>
            </div>

            <!-- Level progress -->
            <div class="level-progress-container">
                <div class="level-badge">{{progressStats.currentLevel}}</div>
                <div class="progress-bar">
                    <div class="progress-fill" [style.width.%]="getLevelProgress()"></div>
                </div>
                <div class="level-xp">
                    {{progressStats.currentXP}} / {{progressStats.nextLevelXP}} XP to next level
                </div>
            </div>

            <!-- Recent results -->
            <div class="recent-results-section" *ngIf="progressStats.recentResults.length > 0">
                <h3 class="section-title">Recent Results</h3>
                <div class="recent-results-list">
                    <div 
                        *ngFor="let result of progressStats.recentResults.slice(0, 5)" 
                        class="result-item"
                        [class.excellent]="result.percentage >= 90"
                        [class.good]="result.percentage >= 70 && result.percentage < 90"
                        [class.fair]="result.percentage >= 50 && result.percentage < 70"
                        [class.poor]="result.percentage < 50">
                        <div class="result-type">
                            <span class="type-icon">
                                {{result.lessonType === 'grammar' ? 'ğŸ“' : 
                                  result.lessonType === 'listening' ? 'ğŸ§' : 'ğŸ“–'}}
                            </span>
                            <span class="type-name">{{result.lessonType | titlecase}}</span>
                        </div>
                        <div class="result-score">{{result.percentage}}%</div>
                        <div class="result-date">{{result.date | date:'short'}}</div>
                    </div>
                </div>
            </div>

            <!-- Message if no data -->
            <div class="no-data-message" *ngIf="progressStats.recentResults.length === 0">
                <div class="no-data-icon">ğŸ¯</div>
                <h3>Start your learning adventure!</h3>
                <p>Complete your first lesson to see your progress here.</p>
                <button class="start-learning-btn" (click)="navigateToSection('lecciones')">
                    Start Learning
                </button>
            </div>

            <!-- Development button to reset progress -->
            <div class="dev-controls" *ngIf="false">
                <button class="reset-btn" (click)="resetProgress()">
                    ğŸ”„ Reset Progress (Dev)
                </button>
            </div>
        </div>

        <!-- Loading state -->
        <div class="loading-container" *ngIf="!progressStats">
            <div class="loading-spinner">â³</div>
            <p>Loading your progress...</p>
        </div>
    </div>
</main>
