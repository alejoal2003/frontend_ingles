<!-- Header -->
<header class="header" role="banner">
    <div class="container">
        <div class="header-content">
            <h1 class="logo" tabindex="1">
                <span class="sr-only">EnglishMaster - Aplicaci√≥n de aprendizaje de ingl√©s</span>
                <span aria-hidden="true">EnglishMaster</span>
            </h1>
            <div class="header-actions" role="toolbar" aria-label="Acciones del usuario">
                <button 
                    class="btn btn-secondary" 
                    (click)="navigateToProfile()" 
                    type="button"
                    tabindex="2"
                    aria-label="Ir al perfil de usuario">
                    <span aria-hidden="true">üë§</span> Perfil
                </button>
                <button 
                    class="btn btn-primary" 
                    (click)="logout()" 
                    type="button"
                    tabindex="3"
                    aria-label="Cerrar sesi√≥n y salir de la aplicaci√≥n">
                    Salir
                </button>
            </div>
        </div>
    </div>
</header>

<!-- Navigation -->
<nav class="nav" role="navigation" aria-label="Navegaci√≥n principal">
    <div class="container">
        <div class="nav-container" role="menubar">
            <button 
                type="button" 
                class="nav-item" 
                (click)="navigateToSection('inicio')" 
                role="menuitem"
                tabindex="4" 
                aria-label="Ir a la secci√≥n de Inicio">
                <span class="nav-icon" aria-hidden="true">üè†</span>
                <span class="nav-text">Inicio</span>
            </button>
            <button 
                type="button" 
                class="nav-item" 
                (click)="navigateToSection('lectura')"
                role="menuitem"
                tabindex="5" 
                aria-label="Ir a la secci√≥n de Lectura">
                <span class="nav-icon" aria-hidden="true">üìñ</span>
                <span class="nav-text">Lecturas</span>
            </button>
            <button 
                type="button" 
                class="nav-item" 
                (click)="navigateToSection('musica')" 
                role="menuitem"
                tabindex="6" 
                aria-label="Ir a la secci√≥n de M√∫sica">
                <span class="nav-icon" aria-hidden="true">üéµ</span>
                <span class="nav-text">M√∫sica</span>
            </button>
            <button 
                type="button" 
                class="nav-item active" 
                (click)="navigateToSection('progreso')" 
                role="menuitem"
                tabindex="7" 
                aria-label="Secci√≥n actual: Progreso"
                aria-current="page"
                aria-pressed="true">
                <span class="nav-icon" aria-hidden="true">üìä</span>
                <span class="nav-text">Progreso</span>
            </button>
            <button 
                type="button" 
                class="nav-item" 
                (click)="navigateToSection('lecciones')" 
                role="menuitem"
                tabindex="8" 
                aria-label="Ir a la secci√≥n de Lecciones">
                <span class="nav-icon" aria-hidden="true">üìö</span>
                <span class="nav-text">Lecciones</span>
            </button>
            <button 
                type="button" 
                class="nav-item" 
                (click)="navigateToSection('config')" 
                role="menuitem"
                tabindex="9" 
                aria-label="Ir a la secci√≥n de Configuraciones">
                <span class="nav-icon" aria-hidden="true">‚öôÔ∏è</span>
                <span class="nav-text">Config</span>
            </button>
        </div>
    </div>
</nav>

<main class="main">
    <div class="container">
        <div class="progress-container" *ngIf="progressStats">
            <div class="progress-header">
                <div class="progress-icon">üìà</div>
                <h2 class="progress-title">Tu Progreso</h2>
            </div>
            
            <div class="progress-content">
                <div class="stats-section">
                    <div class="stat-card">
                        <div class="stat-icon">‚è∞</div>
                        <div class="stat-info">
                            <div class="stat-number">{{formatStudyHours()}}</div>
                            <div class="stat-label">Horas de Estudio</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">üìö</div>
                        <div class="stat-info">
                            <div class="stat-number">{{progressStats.wordsLearned}}</div>
                            <div class="stat-label">Palabras Aprendidas</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">‚úÖ</div>
                        <div class="stat-info">
                            <div class="stat-number">{{progressStats.lessonsCompleted}}</div>
                            <div class="stat-label">Lecciones Completas</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">üéØ</div>
                        <div class="stat-info">
                            <div class="stat-number">{{progressStats.averageAccuracy}}%</div>
                            <div class="stat-label">Precisi√≥n Promedio</div>
                        </div>
                    </div>
                </div>

                <div class="right-panel">
                    <div class="chart-container">
                        <div class="chart-title">Tiempo de Estudio Semanal</div>
                        <div class="bar-chart">
                            <div 
                                *ngFor="let week of getWeeklyChartData()" 
                                class="bar" 
                                [style.height]="getBarHeight(week.hours)"
                                [title]="'Semana: ' + (week.hours || 0) + ' horas'">
                            </div>
                        </div>
                        <div class="chart-labels">
                            <span *ngFor="let week of getWeeklyChartData()">
                                {{(week.hours || 0).toFixed(1)}}h
                            </span>
                        </div>
                    </div>

                    <div class="study-streak-card">
                        <div class="streak-icon">üî•</div>
                        <div class="streak-number">{{progressStats.currentStreak}}</div>
                        <div class="streak-label">D√≠as consecutivos estudiando</div>
                    </div>

                    <div class="goals-achievements">
                        <div class="goals-card" (click)="navigateToSection('lecciones')">
                            <div class="card-icon">üéØ</div>
                            <span>Metas Semanales</span>
                        </div>
                        <div class="achievements-card" (click)="navigateToSection('lecciones')">
                            <div class="card-icon">üèÜ</div>
                            <span>Logros y Medallas</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Secci√≥n de progreso por lecci√≥n -->
            <div class="lesson-stats-section">
                <h3 class="section-title">Rendimiento por Lecci√≥n</h3>
                <div class="lesson-stats-grid">
                    <div class="lesson-stat-card" (click)="startLesson('grammar')">
                        <div class="lesson-icon">üìù</div>
                        <div class="lesson-info">
                            <h4>Gram√°tica</h4>
                            <div class="lesson-metrics">
                                <div class="metric">
                                    <span class="metric-label">Promedio:</span>
                                    <span class="metric-value">{{getGrammarStats().averageScore}}%</span>
                                </div>
                                <div class="metric">
                                    <span class="metric-label">Completadas:</span>
                                    <span class="metric-value">{{getGrammarStats().totalCompleted}}</span>
                                </div>
                                <div class="metric">
                                    <span class="metric-label">Mejor:</span>
                                    <span class="metric-value">{{getGrammarStats().bestScore}}%</span>
                                </div>
                            </div>
                        </div>
                        <div class="lesson-action">‚Üí</div>
                    </div>

                    <div class="lesson-stat-card" (click)="startLesson('listening')">
                        <div class="lesson-icon">üéß</div>
                        <div class="lesson-info">
                            <h4>Listening</h4>
                            <div class="lesson-metrics">
                                <div class="metric">
                                    <span class="metric-label">Promedio:</span>
                                    <span class="metric-value">{{getListeningStats().averageScore}}%</span>
                                </div>
                                <div class="metric">
                                    <span class="metric-label">Completadas:</span>
                                    <span class="metric-value">{{getListeningStats().totalCompleted}}</span>
                                </div>
                                <div class="metric">
                                    <span class="metric-label">Mejor:</span>
                                    <span class="metric-value">{{getListeningStats().bestScore}}%</span>
                                </div>
                            </div>
                        </div>
                        <div class="lesson-action">‚Üí</div>
                    </div>

                    <div class="lesson-stat-card" (click)="startLesson('vocabulary')">
                        <div class="lesson-icon">üìñ</div>
                        <div class="lesson-info">
                            <h4>Vocabulario</h4>
                            <div class="lesson-metrics">
                                <div class="metric">
                                    <span class="metric-label">Promedio:</span>
                                    <span class="metric-value">{{getVocabularyStats().averageScore}}%</span>
                                </div>
                                <div class="metric">
                                    <span class="metric-label">Completadas:</span>
                                    <span class="metric-value">{{getVocabularyStats().totalCompleted}}</span>
                                </div>
                                <div class="metric">
                                    <span class="metric-label">Mejor:</span>
                                    <span class="metric-value">{{getVocabularyStats().bestScore}}%</span>
                                </div>
                            </div>
                        </div>
                        <div class="lesson-action">‚Üí</div>
                    </div>
                </div>
            </div>

            <!-- Progreso de nivel -->
            <div class="level-progress-container">
                <div class="level-badge">{{progressStats.currentLevel}}</div>
                <div class="progress-bar">
                    <div class="progress-fill" [style.width.%]="getLevelProgress()"></div>
                </div>
                <div class="level-xp">
                    {{progressStats.currentXP}} / {{progressStats.nextLevelXP}} XP para el siguiente nivel
                </div>
            </div>

            <!-- Resultados recientes -->
            <div class="recent-results-section" *ngIf="progressStats.recentResults.length > 0">
                <h3 class="section-title">Resultados Recientes</h3>
                <div class="recent-results-list">
                    <div 
                        *ngFor="let result of progressStats.recentResults.slice(0, 5)" 
                        class="result-item"
                        [class.excellent]="result.percentage >= 90"
                        [class.good]="result.percentage >= 70 && result.percentage < 90"
                        [class.fair]="result.percentage >= 50 && result.percentage < 70"
                        [class.poor]="result.percentage < 50">
                        <div class="result-type">
                            <span class="type-icon">
                                {{result.lessonType === 'grammar' ? 'üìù' : 
                                  result.lessonType === 'listening' ? 'üéß' : 'üìñ'}}
                            </span>
                            <span class="type-name">{{result.lessonType | titlecase}}</span>
                        </div>
                        <div class="result-score">{{result.percentage}}%</div>
                        <div class="result-date">{{result.date | date:'short'}}</div>
                    </div>
                </div>
            </div>

            <!-- Mensaje si no hay datos -->
            <div class="no-data-message" *ngIf="progressStats.recentResults.length === 0">
                <div class="no-data-icon">üéØ</div>
                <h3>¬°Comienza tu aventura de aprendizaje!</h3>
                <p>Completa tu primera lecci√≥n para ver tu progreso aqu√≠.</p>
                <button class="start-learning-btn" (click)="navigateToSection('lecciones')">
                    Comenzar a Aprender
                </button>
            </div>

            <!-- Bot√≥n de desarrollo para resetear progreso -->
            <div class="dev-controls" *ngIf="false">
                <button class="reset-btn" (click)="resetProgress()">
                    üîÑ Resetear Progreso (Dev)
                </button>
            </div>
        </div>

        <!-- Loading state -->
        <div class="loading-container" *ngIf="!progressStats">
            <div class="loading-spinner">‚è≥</div>
            <p>Cargando tu progreso...</p>
        </div>
    </div>
</main>
